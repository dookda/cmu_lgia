<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>DataTable with SearchPanes & Excel Export</title>
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <!-- SearchPanes CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/searchpanes/2.1.2/css/searchPanes.dataTables.min.css">
    <!-- DataTables Buttons CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <!-- SearchPanes JS -->
    <script src="https://cdn.datatables.net/searchpanes/2.1.2/js/dataTables.searchPanes.min.js"></script>
    <!-- DataTables Select extension -->
    <script src="https://cdn.datatables.net/select/1.6.2/js/dataTables.select.min.js"></script>

    <!-- JSZip for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <!-- DataTables Buttons JS -->
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
</head>

<body>
    <table id="dataTable" class="display nowrap" style="width:100%"></table>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Example: Fetch data and structure (modify according to your API)
                const response = await fetch('/api/v2/load_layer/fid_1709611155681', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }
                const responseData = await response.json();
                const structure = responseData.structure;
                const data = responseData.data;

                // Map the structure to column definitions
                const columns = structure.map(col => ({
                    data: col.col_id,
                    title: col.col_name
                }));

                // Initialize DataTable with SearchPanes and Excel export button
                $('#dataTable').DataTable({
                    data: data,
                    columns: columns,
                    // Configure DOM: B - Buttons, P - SearchPanes, r - processing, t - table, i - info, p - pagination
                    dom: 'BPrtip',
                    buttons: [
                        {
                            extend: 'excelHtml5',
                            text: 'Export to Excel',
                            titleAttr: 'Export table data to Excel'
                        }
                    ],
                    searchPanes: {
                        cascadePanes: true,
                        initCollapsed: true
                    },
                    scrollX: true,
                    autoWidth: true,
                });
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        });

    </script>
</body>

</html>