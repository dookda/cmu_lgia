<!DOCTYPE html>
<html>

<head>
    <title>Markers with Paint Properties</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
    <!-- Include Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 130px;
            bottom: 0;
            width: 100%;
        }

        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        .bootstrap-icon-marker {
            font-size: 24px;
            /* Icon size */
            color: #FFFFFF;
            /* Icon color */
            background-color: rgba(0, 0, 0, 0.8);
            /* Background color */
            border-radius: 50%;
            /* Circular background */
            padding: 5px;
            /* Padding around the icon */
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>

<body>
    <div id="controls">
        <label>
            <input type="checkbox" id="toggle-group-1" checked /> Show Group 1
        </label>
        <br />
        <label>
            <input type="checkbox" id="toggle-group-2" checked /> Show Group 2
        </label>
        <br />
        <label>
            <input type="checkbox" id="toggle-group-3" checked /> Show Group 3
        </label>
    </div>
    <div id="map"></div>
    <script>
        // Initialize the map
        const map = new maplibregl.Map({
            container: 'map',
            style: 'https://demotiles.maplibre.org/style.json', // Default style
            center: [0, 0], // Initial map center
            zoom: 1 // Initial zoom level
        });

        // Function to generate random coordinates
        const getRandomCoordinates = () => {
            const lng = Math.random() * 360 - 180; // Random longitude (-180 to 180)
            const lat = Math.random() * 180 - 90; // Random latitude (-90 to 90)
            return [lng, lat];
        };

        // Function to generate a random color
        const getRandomColor = () => {
            const r = Math.floor(Math.random() * 256);
            const g = Math.floor(Math.random() * 256);
            const b = Math.floor(Math.random() * 256);
            return `rgb(${r}, ${g}, ${b})`;
        };

        // Integrated markers array with paint properties for circle markers
        const markers = [
            // Icon Markers (Group 1-3)
            { type: 'icon', coordinates: [0, 0], icon: 'bi-camera', name: 'Camera 1', category: 1 },
            { type: 'icon', coordinates: [10, 0], icon: 'bi-camera', name: 'Camera 2', category: 1 },
            { type: 'icon', coordinates: [20, 0], icon: 'bi-camera', name: 'Camera 3', category: 1 },
            { type: 'icon', coordinates: [0, 10], icon: 'bi-star', name: 'Star 1', category: 2 },
            { type: 'icon', coordinates: [10, 10], icon: 'bi-star', name: 'Star 2', category: 2 },
            { type: 'icon', coordinates: [20, 10], icon: 'bi-star', name: 'Star 3', category: 2 },
            { type: 'icon', coordinates: [30, 10], icon: 'bi-star', name: 'Star 4', category: 2 },
            { type: 'icon', coordinates: [0, 20], icon: 'bi-heart', name: 'Heart 1', category: 3 },
            { type: 'icon', coordinates: [10, 20], icon: 'bi-heart', name: 'Heart 2', category: 3 },
            { type: 'icon', coordinates: [20, 20], icon: 'bi-heart', name: 'Heart 3', category: 3 },

            // Circle Markers (Group 1-3) with paint properties
            { type: 'circle', coordinates: getRandomCoordinates(), category: 1, paint: { 'circle-radius': 10, 'circle-color': getRandomColor(), 'circle-opacity': 0.8 } },
            { type: 'circle', coordinates: getRandomCoordinates(), category: 1, paint: { 'circle-radius': 15, 'circle-color': getRandomColor(), 'circle-opacity': 0.8 } },
            { type: 'circle', coordinates: getRandomCoordinates(), category: 2, paint: { 'circle-radius': 10, 'circle-color': getRandomColor(), 'circle-opacity': 0.8 } },
            { type: 'circle', coordinates: getRandomCoordinates(), category: 2, paint: { 'circle-radius': 15, 'circle-color': getRandomColor(), 'circle-opacity': 0.8 } },
            { type: 'circle', coordinates: getRandomCoordinates(), category: 2, paint: { 'circle-radius': 20, 'circle-color': getRandomColor(), 'circle-opacity': 0.8 } },
            { type: 'circle', coordinates: getRandomCoordinates(), category: 3, paint: { 'circle-radius': 10, 'circle-color': getRandomColor(), 'circle-opacity': 0.8 } },
            { type: 'circle', coordinates: getRandomCoordinates(), category: 3, paint: { 'circle-radius': 15, 'circle-color': getRandomColor(), 'circle-opacity': 0.8 } },
            { type: 'circle', coordinates: getRandomCoordinates(), category: 3, paint: { 'circle-radius': 20, 'circle-color': getRandomColor(), 'circle-opacity': 0.8 } },
            { type: 'circle', coordinates: getRandomCoordinates(), category: 3, paint: { 'circle-radius': 25, 'circle-color': getRandomColor(), 'circle-opacity': 0.8 } },
            { type: 'circle', coordinates: getRandomCoordinates(), category: 3, paint: { 'circle-radius': 30, 'circle-color': getRandomColor(), 'circle-opacity': 0.8 } }
        ];

        // Array to store marker instances
        const markerInstances = [];

        // Add markers to the map
        map.on('load', () => {
            markers.forEach((marker, index) => {
                if (marker.type === 'icon') {
                    // Create a custom marker element with Bootstrap Icon
                    const el = document.createElement('div');
                    el.className = 'bootstrap-icon-marker';
                    el.innerHTML = `<i class="${marker.icon}"></i>`;

                    // Create a MapLibre marker
                    const markerInstance = new maplibregl.Marker(el)
                        .setLngLat(marker.coordinates)
                        .setPopup(new maplibregl.Popup().setHTML(`<p>${marker.name}</p>`)) // Add a popup
                        .addTo(map);

                    // Store the marker instance
                    console.log(marker);

                    markerInstances.push({ ...marker, instance: markerInstance });
                    console.log(markerInstances);

                } else if (marker.type === 'circle') {
                    // Add a circle layer with custom paint properties
                    const layerId = `circle-marker-${index}`;
                    map.addLayer({
                        id: layerId,
                        type: 'circle',
                        source: {
                            type: 'geojson',
                            data: {
                                type: 'FeatureCollection',
                                features: [
                                    {
                                        type: 'Feature',
                                        geometry: {
                                            type: 'Point',
                                            coordinates: marker.coordinates
                                        }
                                    }
                                ]
                            }
                        },
                        paint: marker.paint // Use paint properties from the marker object
                    });

                    // Store the circle layer ID
                    markerInstances.push({ ...marker, layerId });
                }
            });
        });

        // Get the checkbox elements
        const toggleGroup1 = document.getElementById('toggle-group-1');
        const toggleGroup2 = document.getElementById('toggle-group-2');
        const toggleGroup3 = document.getElementById('toggle-group-3');

        // Function to toggle markers by category
        const toggleMarkers = (category, checkbox) => {
            markerInstances.forEach(marker => {
                if (marker.category === category) {
                    if (marker.type === 'icon') {
                        // Toggle icon markers
                        if (checkbox.checked) {
                            marker.instance.addTo(map); // Show marker
                        } else {
                            marker.instance.remove(); // Hide marker
                        }
                    } else if (marker.type === 'circle') {
                        // Toggle circle markers
                        map.setLayoutProperty(
                            marker.layerId,
                            'visibility',
                            checkbox.checked ? 'visible' : 'none'
                        );
                    }
                }
            });
        };

        // Add event listeners to the checkboxes
        toggleGroup1.addEventListener('change', () => toggleMarkers(1, toggleGroup1));
        toggleGroup2.addEventListener('change', () => toggleMarkers(2, toggleGroup2));
        toggleGroup3.addEventListener('change', () => toggleMarkers(3, toggleGroup3));
    </script>
</body>

</html>